# DES

Реализация блочного алгоритма шифрования DES. В академических целях. В разработке

# Todo

* Получать 56-битный ключ и расширять его до 64 битами чётности

---

## Таблицы:

* IP.js — таблица начальной перестановки IP
* E.js — таблица функции расширения E
* IP-1.js — таблица конечной перестановки IP<sup>-1</sup>
* S-Boxes.js — S—блоки
* P.js — P-блоки
* PC-1.js — перестановка битов ключа PC-1
* PC-2.js — перестановка битов ключа PC-2

---

## static DES.getBlocks(file_path)

Статический метод. Принимает в качестве аргумента путь к файлу (открытому тексту). Возвращает Promise (массив блоков открытого текста, представленных как 8-байтовые Buffer'ы).

Пример блока (фрагмент строки "hello wo"):

```
block: Buffer(8) [Uint8Array] [104, 101, 108, 108, 111, 32, 119, 111] // (*1)
```

---

## new DES(block, key)

Конструктор. Принимает в качестве аргументов 64-битный блок (Buffer) и 64-битный ключ (строка или Buffer'а). В случае, если длина ключа не равна 64 битам, он обрезается или, наоброт, дополняется (циклически) до 64 бит (см. DES.allocateKey(key)). 

Пример ключа (строка "KEY", дополненная до "KEYKEYKE"):

```
key: Buffer(8) [Uint8Array] [75, 69, 89, 75, 69, 89, 75, 69] // (*4)
```

Устанавливает в качестве статуса состояния (доступен через свойство .status экземпляра класса): **INIT & ALLOCATE_KEY**.

---

## Схема шифрования

```
encrypt() = this
    .transformByteBlockToBinary()
    .ip()
    .getBlockHalves()
    .generateRoundKeys()
```

* encrypt() — зашифровать 64-битный блок данных. Включает последовательность следующих шагов:
    * .transformByteBlockToBinary() — блок данных, представляющий из себя 8-байтовый Buffer представить в виде двоичного массива;
    * .ip() — начальная перестановка бит блока IP;
    * .getBlockHalves() — разделить блок на две части L и R по 32 бита каждая;
    * .generateRoundKeys() — сгенерировать раундовые подключи;
    * .f() — раундовая функция F
    * .fp() — конечная перестановка бит блока IP-1 (FP)
    * .transformBinaryBlockToBytes() — ...

---

## Схема генерации раундовых ключей

```
generateRoundKeys = this
    .transformByteKeyToBinary()
    .pc1()
    .getKeyHalves()
    .initRoundKeys()
    .pc2()
```

* generateRoundKeys() — сгенерировать 16 раундовых ключей
    * .transformByteKeyToBinary() — ...
    * .pc1() — ...
    * .getKeyHalves() — ...
    * .initRoundKeys() — ...
    * .pc2() — ...

---

## Методы класса DES:

### private DES.byteBlockToBinary()

Приватный метод. Преобразует 64-битный блок открытого текста из Buffer'а в двоичный массив нулей и единиц. 

Пример преобразования блока (*1):

```
block: [
    // "h" = 104 = 0b01101000
    '0', '1', '1', '0', '1', '0', '0', '0',
    // "e" = 101 = 0b01100101
    '0', '1', '1', '0', '0', '1', '0', '1',
    // ... 
    '0', '1', '1', '0', '1', '1', '0', '0', 
    '0', '1', '1', '0', '1', '1', '0', '0',
    '0', '1', '1', '0', '1', '1', '1', '1',
    '0', '0', '1', '0', '0', '0', '0', '0', 
    '0', '1', '1', '1', '0', '1', '1', '1', 
    '0', '1', '1', '0', '1', '1', '1', '1'
] // (*2)
```
### private DES.ip()

Приватный метод. Реализует начальную перестановку бит в блоке IP, согласно таблице в файле ./tables/IP.js. 57-ой бит становится нулевым, 49-ый — первым и т. д.

Пример перестановки бит блока (*2):

```
block: [
    // 57, 49, 41, 33, 25, 17,  9, 1, — номера бит из (*2) 
    '1', '1', '0', '1', '1', '1', '1', '1',
    // ...
    '0', '1', '0', '0', '0', '0', '0', '0',
    '1', '1', '0', '1', '1', '1', '1', '0',
    '1', '1', '0', '1', '0', '0', '1', '0',
    '0', '0', '0', '0', '0', '0', '0', '0',
    '1', '1', '1', '1', '1', '1', '1', '1',
    '1', '0', '0', '1', '1', '1', '0', '1',
    '1', '1', '0', '1', '0', '0', '0', '0'
] // (*3)
```

### private DES.getBlockHalves()

Приватный метод. Позволяет получить левую L и правую R части блока (32 бита каждая).

Пример левой части блока (*3):

```
L: [
    '1', '1', '0', '1', '1', '1', '1', '1', 
    '0', '1', '0', '0', '0', '0', '0', '0', 
    '1', '1', '0', '1', '1', '1', '1', '0', 
    '1', '1', '0', '1', '0', '0', '1', '0'
]
```

Пример правой части блока (*3):

```
R: [
    '0', '0', '0', '0', '0', '0', '0', '0', 
    '1', '1', '1', '1', '1', '1', '1', '1', 
    '1', '0', '0', '1', '1', '1', '0', '1',
    '1', '1', '0', '1', '0', '0', '0', '0'
]
```

### private DES.byteKeyToBinary()

Приватный метод. Преобразует 64-битный ключ из Buffer'а в двоичный массив нулей и единиц. 

Пример преобразования ключа (*4):

```
key: [
    // 75 = 0b01001011
    '0', '1', '0', '0', '1', '0', '1', '1', 
    // 69 = 0b01000101
    '0', '1', '0', '0', '0', '1', '0', '1', 
    // ...
    '0', '1', '0', '1', '1', '0', '0', '1',
    '0', '1', '0', '0', '1', '0', '1', '1',
    '0', '1', '0', '0', '0', '1', '0', '1',
    '0', '1', '0', '1', '1', '0', '0', '1',
    '0', '1', '0', '0', '1', '0', '1', '1',
    '0', '1', '0', '0', '0', '1', '0', '1'
] // (*5)
```

# private DES.pc1()

Приватный метод. Из 64-битного ключа отбросить биты чётности (7, 15, 23, 31, 39, 47, 55, 63) и пермешать их, согласно таблице PC-1 в файле ./tables/PC-1.js. В результате ключ сжимается до 56 бит.

Пример ключа (*5) после PC-1:

```
key: [
    '0', '0', '0', '0', '0', '0', '0', '0',
    '1', '1', '1', '1', '1', '1', '1', '1',
    '0', '0', '0', '0', '0', '0', '0', '0',
    '0', '0', '1', '0', '0', '1', '0', '0',
    '1', '0', '0', '1', '1', '0', '0', '1',
    '0', '0', '1', '0', '0', '1', '1', '0',
    '1', '1', '0', '1', '0', '1', '0', '0'
] // (*6)
```

# private DES.getKeyHalves()

...

